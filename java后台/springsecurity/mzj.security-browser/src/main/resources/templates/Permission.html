<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>Test</title>
    <script type="text/javascript"
            th:src="@{/js/jquery-easyui-1.7.0/jquery.min.js}"
            src="/js/jquery-easyui-1.7.0/jquery.min.js"></script>
    <script type="text/javascript"
            th:src="@{/js/jquery.easyui.min.js}"
            src="/js/jquery.easyui.min.js"></script>
    <script type="text/javascript"
            th:src="@{/js/common.js}"
            src="/js/common.js"></script>
    <script type="text/javascript"
            th:src="@{/js/datagrid-filter.js}"
            src="/js/datagrid-filter.js"></script>
    <script type="text/javascript"
            th:src="@{/js/jquery-easyui-1.7.0/easyui-lang-zh_CN.js}"
            src="/js/jquery-easyui-1.7.0/easyui-lang-zh_CN.js"></script>
    <link rel="stylesheet" type="text/css"
          th:href="@{/css/easyui.css}"
          href="../../static/css/easyui.css"/>
    <link rel="stylesheet" type="text/css"
          th:href="@{/css/icon.css}"
          href="../../static/css/icon.css"/>

    <link href="/js/kindeditor-4.1.10/themes/default/default.css"
          th:href="@{/js/kindeditor-4.1.10/themes/default/default.css}"
          type="text/css" rel="stylesheet">
    <script type="text/javascript" charset="utf-8"
            th:src="@{/js/kindeditor-4.1.10/kindeditor-all-min.js}"
            src="/js/kindeditor-4.1.10/kindeditor-all-min.js"></script>
    <script type="text/javascript" charset="utf-8"
            th:src="@{/js/kindeditor-4.1.10/lang/zh_CN.js}"
            src="/js/kindeditor-4.1.10/lang/zh_CN.js"></script>

</head>

<body>
<table class="easyui-datagrid" id="permissionList" title="权限列表"
       data-options="singleSelect:false,collapsible:true,pagination:true,rownumbers:true
       ,url:'/permission',
       	method:'get',pageSize:10,fitColumns:true,toolbar:toolbar_permission">
    <thead>
    <tr>
        <th data-options="field:'ck',checkbox:true"></th>
        <th data-options="field:'permissionId',align:'center',width:100">权限ID</th>
        <th data-options="field:'permissionName',align:'center',width:100">权限名称</th>
        <th data-options="field:'url',align:'center',width:100">url</th>
        <th data-options="field:'permission',align:'center',width:100">权限</th>
     </tr>
    </thead>
</table>

<div id="toolbar_permission" style=" height: 22px; padding: 3px 11px; background: #fafafa;">

    <div style="float: left;">
        <a href="#" class="easyui-linkbutton" plain="true" icon="icon-add" onclick="permission_add()">新增</a>
    </div>
    <div style="float: left;">
        <a href="#" class="easyui-linkbutton" plain="true" icon="icon-edit" onclick="permission_edit()">编辑</a>
    </div>
    <div style="float: left;">
        <a href="#" class="easyui-linkbutton" plain="true" icon="icon-cancel" onclick="permission_delete()">
            删除
        </a>
    </div>
    <div class="datagrid-btn-separator"></div>
    <div style="float: left;">
        <a href="#" class="easyui-linkbutton" plain="true" icon="icon-reload" onclick="permission_reload()">刷新</a>
    </div>

</div>

<div id="permissionEditWindow" class="easyui-window" title="编辑权限"
     data-options="modal:true,
	closed:true,resizable:true,iconCls:'icon-save',href:'/page/PermissionEdit'" style="width:40%;height:70%;padding:10px;">
</div>
<div id="permissionAddWindow" class="easyui-window" title="添加权限" data-options="modal:true,
	closed:true,resizable:true,iconCls:'icon-save',href:'/page/PermissionAdd'" style="width:40%;height:70%;padding:10px;">
</div>


<script type="text/javascript" th:inline="none">

    //根据index拿到该行
    function onPermissionClickRow(index) {
        var rows = $('#permissionList').datagrid('getRows');
        return rows[index];
    }
    function getPermissionSelectionsIds() {
        var permissionList = $("#permissionList");
        var sels = permissionList.datagrid("getSelections");
        var ids = [];
        for (var i in sels) {
            ids.push(sels[i].permissionId);
        }
        ids = ids.join(",");
        return ids;
    }

    function permission_add() {
        $("#permissionAddWindow").window("open");
    }

    function permission_edit() {
        var ids = getPermissionSelectionsIds();

        if (ids.length == 0) {
            $.messager.alert('提示', '必须选择一个权限才能编辑!');
            return;
        }
        if (ids.indexOf(',') > 0) {
            $.messager.alert('提示', '只能选择一个权限!');
            return;
        }

        $("#permissionEditWindow").window({
            onLoad: function () {
                //回显数据
                var data = $("#permissionList").datagrid("getSelections")[0];
                $("#permissionEditForm").form("load", data);

            }
        }).window("open");

    }

    function permission_delete() {
        var ids = getPermissionSelectionsIds();
        if (ids.length == 0) {
            $.messager.alert('提示', '未选中权限!');
            return;
        }
        $.messager.confirm('确认', '确定删除ID为 ' + ids + ' 的权限吗？', function (r) {
            if (r) {
                var params = {"ids": ids};
                $.post("/permission/delete_batch", params, function (data) {
                    if (data.status == 200) {
                        $.messager.alert('提示', '删除权限成功!', undefined, function () {
                            $("#permissionList").datagrid("reload");
                        });
                    }
                });
            }
        });
    }

    function permission_reload() {
        $("#permissionList").datagrid("reload");
    }
</script>
</body>
</html>
